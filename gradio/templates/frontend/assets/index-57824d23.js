import{S as ze,i as je,s as Ce,B as ve,C as p,g as D,E as ge,F as le,q as B,ad as sn,G as re,L as Ie,r as Je,b as N,H as $,a9 as st,ag as ht,p as v,l as pe,t as T,o as we,N as Ot,u as ct,T as Te,a4 as Jt,aa as ot,ab as at,D as Gt,M as V,J as Q,aj as Qt,$ as mt,y as be,e as X,m as Y,n as P,f as Xe,ac as ut,ak as rn,a as fe,k as _e,U as on,W as an,X as un,Y as fn,x as _n,Z as hn,h as cn,j as mn}from"./index-56e7be3e.js";import{B as gn}from"./Button-800741cf.js";import{B as dn}from"./BlockLabel-32a05e8d.js";/* empty css                                                    */import{I as pt}from"./Image-423bdd84.js";import{C as bn,i as Vt,U as pn,W as wn}from"./StaticImage.svelte_svelte_type_style_lang-be766fc7.js";import{I as it,C as kn,M as ft}from"./ModifyUpload-db1fd677.js";import{U as vn}from"./Upload-25321626.js";import"./Blocks-6c0ce475.js";import{U as Zt}from"./UploadText-0eab38ba.js";import{E as Bl}from"./Image-d1b65394.js";import"./ModifyUpload.svelte_svelte_type_style_lang-d2acacf0.js";function In(t){let e,n,l;return{c(){e=ve("svg"),n=ve("path"),l=ve("path"),p(n,"d","M28.828 3.172a4.094 4.094 0 0 0-5.656 0L4.05 22.292A6.954 6.954 0 0 0 2 27.242V30h2.756a6.952 6.952 0 0 0 4.95-2.05L28.828 8.829a3.999 3.999 0 0 0 0-5.657zM10.91 18.26l2.829 2.829l-2.122 2.121l-2.828-2.828zm-2.619 8.276A4.966 4.966 0 0 1 4.756 28H4v-.759a4.967 4.967 0 0 1 1.464-3.535l1.91-1.91l2.829 2.828zM27.415 7.414l-12.261 12.26l-2.829-2.828l12.262-12.26a2.047 2.047 0 0 1 2.828 0a2 2 0 0 1 0 2.828z"),p(n,"fill","currentColor"),p(l,"d","M6.5 15a3.5 3.5 0 0 1-2.475-5.974l3.5-3.5a1.502 1.502 0 0 0 0-2.121a1.537 1.537 0 0 0-2.121 0L3.415 5.394L2 3.98l1.99-1.988a3.585 3.585 0 0 1 4.95 0a3.504 3.504 0 0 1 0 4.949L5.439 10.44a1.502 1.502 0 0 0 0 2.121a1.537 1.537 0 0 0 2.122 0l4.024-4.024L13 9.95l-4.025 4.024A3.475 3.475 0 0 1 6.5 15z"),p(l,"fill","currentColor"),p(e,"width","100%"),p(e,"height","100%"),p(e,"viewBox","0 0 32 32")},m(r,o){D(r,e,o),ge(e,n),ge(e,l)},p:le,i:le,o:le,d(r){r&&B(e)}}}class yn extends ze{constructor(e){super(),je(this,e,null,In,Ce,{})}}function Cn(t){let e,n,l,r,o,s,a;return{c(){e=ve("svg"),n=ve("circle"),l=ve("circle"),r=ve("circle"),o=ve("circle"),s=ve("circle"),a=ve("path"),p(n,"cx","10"),p(n,"cy","12"),p(n,"r","2"),p(n,"fill","currentColor"),p(l,"cx","16"),p(l,"cy","9"),p(l,"r","2"),p(l,"fill","currentColor"),p(r,"cx","22"),p(r,"cy","12"),p(r,"r","2"),p(r,"fill","currentColor"),p(o,"cx","23"),p(o,"cy","18"),p(o,"r","2"),p(o,"fill","currentColor"),p(s,"cx","19"),p(s,"cy","23"),p(s,"r","2"),p(s,"fill","currentColor"),p(a,"fill","currentColor"),p(a,"d","M16.54 2A14 14 0 0 0 2 16a4.82 4.82 0 0 0 6.09 4.65l1.12-.31a3 3 0 0 1 3.79 2.9V27a3 3 0 0 0 3 3a14 14 0 0 0 14-14.54A14.05 14.05 0 0 0 16.54 2Zm8.11 22.31A11.93 11.93 0 0 1 16 28a1 1 0 0 1-1-1v-3.76a5 5 0 0 0-5-5a5.07 5.07 0 0 0-1.33.18l-1.12.31A2.82 2.82 0 0 1 4 16A12 12 0 0 1 16.47 4A12.18 12.18 0 0 1 28 15.53a11.89 11.89 0 0 1-3.35 8.79Z"),p(e,"width","100%"),p(e,"height","100%"),p(e,"viewBox","0 0 32 32")},m(i,f){D(i,e,f),ge(e,n),ge(e,l),ge(e,r),ge(e,o),ge(e,s),ge(e,a)},p:le,i:le,o:le,d(i){i&&B(e)}}}class An extends ze{constructor(e){super(),je(this,e,null,Cn,Ce,{})}}function Mn(t){let e,n;return{c(){e=ve("svg"),n=ve("path"),p(n,"fill","currentColor"),p(n,"d","M7 27h23v2H7zm20.38-16.49l-7.93-7.92a2 2 0 0 0-2.83 0l-14 14a2 2 0 0 0 0 2.83L7.13 24h9.59l10.66-10.66a2 2 0 0 0 0-2.83zM15.89 22H8l-4-4l6.31-6.31l7.93 7.92zm3.76-3.76l-7.92-7.93L18 4l8 7.93z"),p(e,"xmlns","http://www.w3.org/2000/svg"),p(e,"width","100%"),p(e,"height","100%"),p(e,"viewBox","0 0 32 32")},m(l,r){D(l,e,r),ge(e,n)},p:le,i:le,o:le,d(l){l&&B(e)}}}class Rn extends ze{constructor(e){super(),je(this,e,null,Mn,Ce,{})}}function Tn(t){let e,n;return{c(){e=ve("svg"),n=ve("path"),p(n,"d","M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"),p(e,"xmlns","http://www.w3.org/2000/svg"),p(e,"width","100%"),p(e,"height","100%"),p(e,"viewBox","0 0 24 24"),p(e,"fill","none"),p(e,"stroke","currentColor"),p(e,"stroke-width","1.5"),p(e,"stroke-linecap","round"),p(e,"stroke-linejoin","round"),p(e,"class","feather feather-edit-2")},m(l,r){D(l,e,r),ge(e,n)},p:le,i:le,o:le,d(l){l&&B(e)}}}let wt=class extends ze{constructor(e){super(),je(this,e,null,Tn,Ce,{})}};const zn=t=>{let e=t.currentTarget;const n=e.getBoundingClientRect(),l=e.naturalWidth/n.width,r=e.naturalHeight/n.height;if(l>r){n.width;const i=e.naturalHeight/l,f=(n.height-i)/2;var o=Math.round((t.clientX-n.left)*l),s=Math.round((t.clientY-n.top-f)*l)}else{const i=e.naturalWidth/r;n.height;const f=(n.width-i)/2;var o=Math.round((t.clientX-n.left-f)*r),s=Math.round((t.clientY-n.top)*r)}const a=typeof t.currentTarget;return console.log(a),console.log(e.naturalWidth,e.naturalHeight),console.log(t.clientX,t.clientY,l,r,o,s),console.log(n),o<0||o>=e.naturalWidth||s<0||s>=e.naturalHeight?null:[o,s]};function jn(t){let e,n;return{c(){e=re("img"),Ie(e.src,n=t[0])||p(e,"src",n),p(e,"alt","")},m(l,r){D(l,e,r),t[4](e)},p(l,[r]){r&1&&!Ie(e.src,n=l[0])&&p(e,"src",n)},i:le,o:le,d(l){l&&B(e),t[4](null)}}}function Dn(t,e,n){let{image:l}=e,r;const o=Je();let s;function a(){s.destroy()}function i(){s&&a(),s=new bn(r,{autoCropArea:1,cropend(){const u=s.getCroppedCanvas().toDataURL();o("crop",u)}}),o("crop",l)}function f(u){N[u?"unshift":"push"](()=>{r=u,n(1,r)})}return t.$$set=u=>{"image"in u&&n(0,l=u.image)},[l,r,a,i,f]}class Kt extends ze{constructor(e){super(),je(this,e,Dn,jn,Ce,{image:0,destroy:2,create:3})}get image(){return this.$$.ctx[0]}set image(e){this.$$set({image:e}),sn()}get destroy(){return this.$$.ctx[2]}get create(){return this.$$.ctx[3]}}class kt{constructor(e,n){this.x=e,this.y=n}}class vt extends kt{update(e){this.x=e.x,this.y=e.y}moveByAngle(e,n){const l=e+Math.PI/2;this.x=this.x+Math.sin(l)*n,this.y=this.y-Math.cos(l)*n}equalsTo(e){return this.x===e.x&&this.y===e.y}getDifferenceTo(e){return new kt(this.x-e.x,this.y-e.y)}getDistanceTo(e){const n=this.getDifferenceTo(e);return Math.sqrt(Math.pow(n.x,2)+Math.pow(n.y,2))}getAngleTo(e){const n=this.getDifferenceTo(e);return Math.atan2(n.y,n.x)}toObject(){return{x:this.x,y:this.y}}}const Bn=30;class xt{constructor({radius:e=Bn,enabled:n=!0,initialPoint:l={x:0,y:0}}={}){this.radius=e,this._isEnabled=n,this.pointer=new vt(l.x,l.y),this.brush=new vt(l.x,l.y),this.angle=0,this.distance=0,this._hasMoved=!1}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}isEnabled(){return this._isEnabled}setRadius(e){this.radius=e}getRadius(){return this.radius}getBrushCoordinates(){return this.brush.toObject()}getPointerCoordinates(){return this.pointer.toObject()}getBrush(){return this.brush}getPointer(){return this.pointer}getAngle(){return this.angle}getDistance(){return this.distance}brushHasMoved(){return this._hasMoved}update(e,{both:n=!1}={}){return this._hasMoved=!1,this.pointer.equalsTo(e)&&!n?!1:(this.pointer.update(e),n?(this._hasMoved=!0,this.brush.update(e),!0):(this._isEnabled?(this.distance=this.pointer.getDistanceTo(this.brush),this.angle=this.pointer.getAngleTo(this.brush),this.distance>this.radius&&(this.brush.moveByAngle(this.angle,this.distance-this.radius),this._hasMoved=!0)):(this.distance=0,this.angle=0,this.brush.update(e),this._hasMoved=!0),!0))}}function It(t,e,n){const l=t.slice();return l[61]=e[n].name,l[62]=e[n].zIndex,l[63]=e,l[64]=n,l}function yt(t){let e,n,l;return{c(){e=re("div"),e.textContent="Start drawing",p(e,"class","start-prompt svelte-yigbas")},m(r,o){D(r,e,o),l=!0},i(r){l||(st(()=>{l&&(n||(n=ot(e,at,{duration:50},!0)),n.run(1))}),l=!0)},o(r){n||(n=ot(e,at,{duration:50},!1)),n.run(0),l=!1},d(r){r&&B(e),r&&n&&n.end()}}}function Ct(t){let e,n=t[61],l,r;const o=()=>t[30](e,n),s=()=>t[30](null,n);return{c(){e=re("canvas"),p(e,"key",t[61]),Gt(e,"z-index",t[62]),p(e,"class","svelte-yigbas"),V(e,"lr",t[5]),V(e,"tb",!t[5])},m(a,i){D(a,e,i),o(),l||(r=[Q(e,"mousedown",t[61]==="interface"?t[7]:void 0),Q(e,"mousemove",t[61]==="interface"?t[8]:void 0),Q(e,"mouseup",t[61]==="interface"?t[9]:void 0),Q(e,"mouseout",t[61]==="interface"?t[9]:void 0),Q(e,"blur",t[61]==="interface"?t[9]:void 0),Q(e,"touchstart",t[61]==="interface"?t[7]:void 0),Q(e,"touchmove",t[61]==="interface"?t[8]:void 0),Q(e,"touchend",t[61]==="interface"?t[9]:void 0),Q(e,"touchcancel",t[61]==="interface"?t[9]:void 0),Q(e,"click",Qt(t[29]))],l=!0)},p(a,i){t=a,n!==t[61]&&(s(),n=t[61],o()),i[0]&32&&V(e,"lr",t[5]),i[0]&32&&V(e,"tb",!t[5])},d(a){a&&B(e),s(),l=!1,mt(r)}}}function Ln(t){let e,n,l,r,o=t[4]===0&&yt(),s=t[6],a=[];for(let i=0;i<s.length;i+=1)a[i]=Ct(It(t,s,i));return{c(){e=re("div"),o&&o.c(),n=$();for(let i=0;i<a.length;i+=1)a[i].c();p(e,"class","wrap svelte-yigbas"),st(()=>t[32].call(e))},m(i,f){D(i,e,f),o&&o.m(e,null),ge(e,n);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(e,null);t[31](e),l=ht(e,t[32].bind(e)),r=!0},p(i,f){if(i[4]===0?o?f[0]&16&&v(o,1):(o=yt(),o.c(),v(o,1),o.m(e,n)):o&&(pe(),T(o,1,1,()=>{o=null}),we()),f[0]&993){s=i[6];let u;for(u=0;u<s.length;u+=1){const c=It(i,s,u);a[u]?a[u].p(c,f):(a[u]=Ct(c),a[u].c(),a[u].m(e,null))}for(;u<a.length;u+=1)a[u].d(1);a.length=s.length}},i(i){r||(v(o),r=!0)},o(i){T(o),r=!1},d(i){i&&B(e),o&&o.d(),Ot(a,i),t[31](null),l()}}}let En="#aaa";function At(t,e){return{x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2}}function Sn(t,e,n){let l;const r=Je();let{value:o}=e,{value_img:s}=e,{mode:a="sketch"}=e,{brush_color:i="#0b0f19"}=e,{brush_radius:f}=e,{source:u}=e,{width:c=400}=e,{height:_=200}=e,{container_height:b=200}=e,{shape:M}=e,z,ce=c,U=_,S;const g=[{name:"interface",zIndex:15},{name:"drawing",zIndex:11},{name:"temp",zIndex:12},{name:"mask",zIndex:-1},{name:"temp_fake",zIndex:-2}];let A={},w={},L=[],ee=[],oe=!0,K=!0,x=!1,me=!1,te=null,he=null,H=null,O=0;function F(){if(!M){w.temp.drawImage(s,0,0,c,_);return}let m=s.naturalWidth,j=s.naturalHeight;const q=M[0]/M[1],W=m/j;let G=0,se=0;q<W?(m=M[1]*W,j=M[1],G=(M[0]-m)/2):q>W?(m=M[0],j=M[0]/W,se=(M[1]-j)/2):(G=0,se=0,m=M[0],j=M[1]),w.temp.drawImage(s,G,se,m,j)}ct(async()=>{Object.keys(A).forEach(m=>{n(26,w[m]=A[m].getContext("2d"),w)}),await Te(),s&&(s.addEventListener("load",m=>{u==="webcam"?(w.temp.save(),w.temp.translate(c,0),w.temp.scale(-1,1),w.temp.drawImage(s,0,0),w.temp.restore()):F(),w.drawing.drawImage(A.temp,0,0,c,_),Me()}),setTimeout(()=>{u==="webcam"?(w.temp.save(),w.temp.translate(c,0),w.temp.scale(-1,1),w.temp.drawImage(s,0,0),w.temp.restore()):F(),w.drawing.drawImage(A.temp,0,0,c,_),ye({lines:ee.slice()}),Me()},100)),n(28,te=new xt({radius:f*.05,enabled:!0,initialPoint:{x:c/2,y:_/2}})),H=new Vt((m,j,...q)=>{Ye()}),H.observe(he),He(),n(24,z=!0),requestAnimationFrame(()=>{Z(),requestAnimationFrame(()=>{Ee()})})});function Z(){const m=c/2,j=_/2;te.update({x:m,y:j},{both:!0}),te.update({x:m,y:j},{both:!1}),oe=!0,K=!0}Jt(()=>{n(24,z=!1),H.unobserve(he)});function ne(m){Ze(),s&&(u==="webcam"?(w.temp.save(),w.temp.translate(c,0),w.temp.scale(-1,1),w.temp.drawImage(s,0,0),w.temp.restore()):F(),(!ee||!ee.length)&&w.drawing.drawImage(A.temp,0,0,c,_)),ye({lines:m}),n(4,O=m.length),ee.length&&n(27,ee=m),ee.length==0&&r("clear")}function ae(){ne([]),Me()}function ie(){const m=ee.slice(0,-1);ne(m),Me()}let ye=({lines:m})=>{m.forEach(j=>{const{points:q,brush_color:W,brush_radius:G}=j;de({points:q,brush_color:W,brush_radius:G}),a==="mask"&&Ge({points:q,brush_color:W,brush_radius:G}),L=q}),Ve(),a==="mask"&&Qe()},Ae=m=>{m.preventDefault(),me=!0;const{x:j,y:q}=Fe(m);m.touches&&m.touches.length>0&&te.update({x:j,y:q},{both:!0}),We(j,q),n(4,O+=1)},De=m=>{m.preventDefault();const{x:j,y:q}=Fe(m);We(j,q)},Se=m=>{m.preventDefault(),De(m),x=!1,me=!1,Ve(),a==="mask"&&Qe()},qe=0,Ue=0,Be=0,k=!1,Ye=async()=>{if(M&&he){const q=he?.getBoundingClientRect(),W=M[0]/M[1],G=q.width/q.height;n(5,k=W<G)}if(c===qe&&_===Ue&&Be===b)return;const m={width:c,height:_},j={height:b,width:b*(m.width/m.height)};await Promise.all([Le(A.interface,m,j),Le(A.drawing,m,j),Le(A.temp,m,j),Le(A.temp_fake,m,j),Le(A.mask,m,j,!1)]),f||n(10,f=20*(m.width/j.width)),He({once:!0}),setTimeout(()=>{Ue=_,qe=c,Be=b},10),await Te(),Ee()},Le=async(m,j,q,W=!0)=>{if(!z)return;await Te();const G=window.devicePixelRatio||1;m.width=j.width*(W?G:1),m.height=j.height*(W?G:1);const se=m.getContext("2d");W&&se.scale(G,G),m.style.width=`${q.width}px`,m.style.height=`${q.height}px`},Fe=m=>{const j=A.interface.getBoundingClientRect();let q=m.clientX,W=m.clientY;return m.changedTouches&&m.changedTouches.length>0&&(q=m.changedTouches[0].clientX,W=m.changedTouches[0].clientY),{x:(q-j.left)/j.width*c,y:(W-j.top)/j.height*_}},We=(m,j)=>{te.update({x:m,y:j});const q=!te.isEnabled();(me&&!x||q&&me)&&(x=!0,L.push(te.brush.toObject())),x&&(L.push(te.brush.toObject()),de({points:L,brush_color:i,brush_radius:f}),a==="mask"&&Ge({points:L,brush_color:i,brush_radius:f})),oe=!0},de=({points:m,brush_color:j,brush_radius:q})=>{if(!m||m.length<2||(n(26,w.temp.lineJoin="round",w),n(26,w.temp.lineCap="round",w),n(26,w.temp.strokeStyle=j,w),n(26,w.temp.lineWidth=q,w),!m||m.length<2))return;let W=m[0],G=m[1];w.temp.moveTo(G.x,G.y),w.temp.beginPath();for(var se=1,Ne=m.length;se<Ne;se++){var ke=At(W,G);w.temp.quadraticCurveTo(W.x,W.y,ke.x,ke.y),W=m[se],G=m[se+1]}w.temp.lineTo(W.x,W.y),w.temp.stroke()},Ge=({points:m,brush_color:j,brush_radius:q})=>{if(!m||m.length<2)return;n(26,w.temp_fake.lineJoin="round",w),n(26,w.temp_fake.lineCap="round",w),n(26,w.temp_fake.strokeStyle="#fff",w),n(26,w.temp_fake.lineWidth=q,w);let W=m[0],G=m[1];w.temp_fake.moveTo(G.x,G.y),w.temp_fake.beginPath();for(var se=1,Ne=m.length;se<Ne;se++){var ke=At(W,G);w.temp_fake.quadraticCurveTo(W.x,W.y,ke.x,ke.y),W=m[se],G=m[se+1]}w.temp_fake.lineTo(W.x,W.y),w.temp_fake.stroke()},Qe=()=>{L.length<1||(L.length=0,w.mask.drawImage(A.temp_fake,0,0,c,_),Me())},Ve=()=>{L.length<1||(ee.push({points:L.slice(),brush_color:i,brush_radius:f}),a!=="mask"&&(L.length=0),w.drawing.drawImage(A.temp,0,0,c,_),Me())},Me=()=>{const m=Pe();r("change",m)};function Ee(){return n(27,ee=[]),Ze(),n(4,O=0),!0}function Ze(){K=!0,w.temp.clearRect(0,0,c,_),n(26,w.temp.fillStyle=a==="mask"?"transparent":"#FFFFFF",w),w.temp.fillRect(0,0,c,_),a==="mask"&&(w.temp_fake.clearRect(0,0,A.temp_fake.width,A.temp_fake.height),w.mask.clearRect(0,0,c,_),n(26,w.mask.fillStyle="#000",w),w.mask.fillRect(0,0,c,_))}let He=({once:m=!1}={})=>{if(oe||K){const j=te.getPointerCoordinates(),q=te.getBrushCoordinates();nt(w.interface,j,q),oe=!1,K=!1}m||window.requestAnimationFrame(()=>{He()})},nt=(m,j,q)=>{m.clearRect(0,0,c,_),m.beginPath(),m.fillStyle=i,m.arc(q.x,q.y,f/2,0,Math.PI*2,!0),m.fill(),m.beginPath(),m.fillStyle=En,m.arc(q.x,q.y,l,0,Math.PI*2,!0),m.fill()};function Pe(){return a==="mask"?A.mask.toDataURL("image/jpg"):A.drawing.toDataURL("image/jpg")}function Ke(m){be.call(this,t,m)}function xe(m,j){N[m?"unshift":"push"](()=>{A[j]=m,n(0,A)})}function $e(m){N[m?"unshift":"push"](()=>{he=m,n(3,he)})}function et(){ce=this.offsetWidth,U=this.offsetHeight,n(1,ce),n(2,U)}return t.$$set=m=>{"value"in m&&n(13,o=m.value),"value_img"in m&&n(14,s=m.value_img),"mode"in m&&n(15,a=m.mode),"brush_color"in m&&n(16,i=m.brush_color),"brush_radius"in m&&n(10,f=m.brush_radius),"source"in m&&n(17,u=m.source),"width"in m&&n(11,c=m.width),"height"in m&&n(12,_=m.height),"container_height"in m&&n(18,b=m.container_height),"shape"in m&&n(19,M=m.shape)},t.$$.update=()=>{t.$$.dirty[0]&530432&&M&&(c||_)&&(n(11,c=M[0]),n(12,_=M[1])),t.$$.dirty[0]&16785408&&z&&!o&&Ee(),t.$$.dirty[0]&251811841&&z&&s!==S&&(n(25,S=s),Ee(),setTimeout(()=>{u==="webcam"?(w.temp.save(),w.temp.translate(c,0),w.temp.scale(-1,1),w.temp.drawImage(s,0,0),w.temp.restore()):F(),w.drawing.drawImage(A.temp,0,0,c,_),ye({lines:ee.slice()}),Me()},50)),t.$$.dirty[0]&268436480&&te&&(Z(),te.setRadius(f*.05)),t.$$.dirty[0]&6144&&(c||_)&&Ye(),t.$$.dirty[0]&1024&&(l=f*.075)},[A,ce,U,he,O,k,g,Ae,De,Se,f,c,_,o,s,a,i,u,b,M,ae,ie,Ee,Pe,z,S,w,ee,te,Ke,xe,$e,et]}class gt extends ze{constructor(e){super(),je(this,e,Sn,Ln,Ce,{value:13,value_img:14,mode:15,brush_color:16,brush_radius:10,source:17,width:11,height:12,container_height:18,shape:19,clear_mask:20,undo:21,clear:22,get_image_data:23},null,[-1,-1,-1])}get clear_mask(){return this.$$.ctx[20]}get undo(){return this.$$.ctx[21]}get clear(){return this.$$.ctx[22]}get get_image_data(){return this.$$.ctx[23]}}function Mt(t,e,n){const l=t.slice();return l[79]=e[n].name,l[80]=e[n].zIndex,l[81]=e,l[82]=n,l}function Rt(t){let e,n,l;return{c(){e=re("div"),e.textContent="Start drawing",p(e,"class","start-prompt svelte-je14w8")},m(r,o){D(r,e,o),l=!0},i(r){l||(st(()=>{l&&(n||(n=ot(e,at,{duration:50},!0)),n.run(1))}),l=!0)},o(r){n||(n=ot(e,at,{duration:50},!1)),n.run(0),l=!1},d(r){r&&B(e),r&&n&&n.end()}}}function Tt(t){let e,n=t[79],l,r;const o=()=>t[30](e,n),s=()=>t[30](null,n);return{c(){e=re("canvas"),p(e,"key",t[79]),Gt(e,"z-index",t[80]),p(e,"class","svelte-je14w8"),V(e,"lr",t[5]),V(e,"tb",!t[5])},m(a,i){D(a,e,i),o(),l||(r=[Q(e,"mousedown",t[79]==="interface"?t[7]:t[79]==="drawing"?t[10]:void 0),Q(e,"mousemove",t[79]==="interface"?t[8]:t[79]==="drawing"?t[11]:void 0),Q(e,"mouseup",t[79]==="interface"?t[9]:t[79]==="drawing"?t[12]:void 0),Q(e,"blur",t[79]==="interface"?t[9]:void 0),Q(e,"touchstart",t[79]==="interface"?t[7]:void 0),Q(e,"touchmove",t[79]==="interface"?t[8]:void 0),Q(e,"touchend",t[79]==="interface"?t[9]:void 0),Q(e,"touchcancel",t[79]==="interface"?t[9]:void 0),Q(e,"click",Qt(t[29]))],l=!0)},p(a,i){t=a,n!==t[79]&&(s(),n=t[79],o()),i[0]&32&&V(e,"lr",t[5]),i[0]&32&&V(e,"tb",!t[5])},d(a){a&&B(e),s(),l=!1,mt(r)}}}function qn(t){let e,n,l,r,o=t[4]===0&&Rt(),s=t[6],a=[];for(let i=0;i<s.length;i+=1)a[i]=Tt(Mt(t,s,i));return{c(){e=re("div"),o&&o.c(),n=$();for(let i=0;i<a.length;i+=1)a[i].c();p(e,"class","wrap svelte-je14w8"),st(()=>t[32].call(e))},m(i,f){D(i,e,f),o&&o.m(e,null),ge(e,n);for(let u=0;u<a.length;u+=1)a[u]&&a[u].m(e,null);t[31](e),l=ht(e,t[32].bind(e)),r=!0},p(i,f){if(i[4]===0?o?f[0]&16&&v(o,1):(o=Rt(),o.c(),v(o,1),o.m(e,n)):o&&(pe(),T(o,1,1,()=>{o=null}),we()),f[0]&8164){s=i[6];let u;for(u=0;u<s.length;u+=1){const c=Mt(i,s,u);a[u]?a[u].p(c,f):(a[u]=Tt(c),a[u].c(),a[u].m(e,null))}for(;u<a.length;u+=1)a[u].d(1);a.length=s.length}},i(i){r||(v(o),r=!0)},o(i){T(o),r=!1},d(i){i&&B(e),o&&o.d(),Ot(a,i),t[31](null),l()}}}function zt(t,e){return{x:t.x+(e.x-t.x)/2,y:t.y+(e.y-t.y)/2}}function rt(t){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=t.width,e.height=t.height,n.putImageData(t,0,0);var l=e.toDataURL(),r=new Image;return r.src=l,r}function jt(t){const e=document.createElement("canvas");e.width=t.naturalWidth,e.height=t.naturalHeight;const n=e.getContext("2d");return n.drawImage(t,0,0),n.getImageData(0,0,e.width,e.height)}function Un(t,e,n){const l=Je();let{value:r}=e,{value_img:o}=e,{mode:s="sketch"}=e,{brush_color:a="#0b0f19"}=e,{brush_radius:i}=e,{source:f}=e,{width:u=400}=e,{height:c=200}=e,{container_height:_=200}=e,{shape:b}=e,M,z=u,ce=c;const U=[{name:"interface",zIndex:15},{name:"drawing",zIndex:16},{name:"temp",zIndex:12},{name:"mask",zIndex:-1},{name:"temp_fake",zIndex:-2}];let S={},g={},A=[],w=[],L=!0,ee=!0,oe=!1,K=!1,x=null,me=null,te=null,he=0,H=null,O=null,F=null,Z=[],ne=null,ae=0,ie=null,ye=null;function Ae(){if(!b){if(S.temp.getBoundingClientRect(),F!=null&&F.complete==!0&&(g.temp.drawImage(F,0,0,u,c),Z.length>0))for(let J=0;J<Z.length;J++){const{img:ue,pos:_t}=Z[J];g.temp.drawImage(ue,_t.left,_t.top)}return}console.log("shape:"),console.log(b);let h=o.naturalWidth,I=o.naturalHeight;const C=b[0]/b[1],y=h/I;let R=0,E=0;C<y?(h=b[1]*y,I=b[1],R=(b[0]-h)/2):C>y?(h=b[0],I=b[0]/y,E=(b[1]-I)/2):(R=0,E=0,h=b[0],I=b[1]),g.temp.drawImage(o,R,E,h,I)}ct(async()=>{if(Object.keys(S).forEach(C=>{g[C]=S[C].getContext("2d")}),await Te(),o){console.log("Compose.svelte:onMount: value_img.complete:",o.complete),console.log("Compose.svelte:onMount: value_img:",o),Z=[],ne=null,ae=0,ie=null,ye=null,H=jt(o),O=new ImageData(H.width,H.height),O.data.set(H.data);for(var h=O.data,I=0;I<h.length;I+=4)h[I+3]!=255&&(h[I+3]=255);F=rt(O),F.onload=C=>{console.log("value_img_opaque loaded"),console.log("value_img_opaque:",F),Ae(),g.drawing.drawImage(S.temp,0,0,u,c)},ke("onMount line 211")}o.addEventListener("load",C=>{console.log("Compose.svelte:value_img loaded"),Z=[],ne=null,ae=0,ie=null,ye=null,H=jt(o),O=new ImageData(H.width,H.height),O.data.set(H.data);for(var y=O.data,R=0;R<y.length;R+=4)y[R+3]!=255&&(y[R+3]=255);F=rt(O),console.log("value_img_opaque.complete:",F.complete),F.onload=E=>{console.log("value_img_opaque loaded"),console.log("value_img_opaque:",F),Ae(),g.drawing.drawImage(S.temp,0,0,u,c)}}),document.onmouseup=C=>{K&&(console.log("handle drag ended outside element"),K=!1,L=!0,He(ae),l("select",{index:[1e4,1e4],value:ae}),console.log("handle_drag_end (to outside): dispatch (select)"))},setTimeout(()=>{f==="webcam"?(g.temp.save(),g.temp.translate(u,0),g.temp.scale(-1,1),g.temp.drawImage(o,0,0),g.temp.restore()):(console.log("setTimeout: draw_cropped_image"),Ae()),g.drawing.drawImage(S.temp,0,0,u,c),Be({lines:w.slice()}),ke("onMount line 236")},100),n(28,x=new xt({radius:i*.05,enabled:!0,initialPoint:{x:u/2,y:c/2}})),te=new Vt((C,y,...R)=>{et()}),te.observe(me),lt(),n(27,M=!0),requestAnimationFrame(()=>{De(),requestAnimationFrame(()=>{tt()})})});function De(){const h=u/2,I=c/2;x.update({x:h,y:I},{both:!0}),x.update({x:h,y:I},{both:!1}),L=!0,ee=!0}Jt(()=>{n(27,M=!1),te.unobserve(me)});function Se(h){Oe(),o&&(f==="webcam"?(g.temp.save(),g.temp.translate(u,0),g.temp.scale(-1,1),g.temp.drawImage(o,0,0),g.temp.restore()):Ae(),(!w||!w.length)&&g.drawing.drawImage(S.temp,0,0,u,c)),Be({lines:h}),n(4,he=h.length),w.length&&(w=h),w.length==0&&l("clear")}function qe(){Se([]),ke("clear_mask")}function Ue(){const h=w.slice(0,-1);Se(h),ke("undo")}let Be=({lines:h})=>{h.forEach(I=>{const{points:C,brush_color:y,brush_radius:R}=I;W({points:C,brush_color:y,brush_radius:R}),s==="mask"&&G({points:C,brush_color:y,brush_radius:R}),A=C}),Ne(),s==="mask"&&se()},k=h=>{h.preventDefault(),K=!0;const{x:I,y:C}=j(h);h.touches&&h.touches.length>0&&x.update({x:I,y:C},{both:!0}),q(I,C),n(4,he+=1)},Ye=h=>{h.preventDefault();const{x:I,y:C}=j(h);Oe(),q(I,C)},Le=h=>{h.preventDefault(),Ye(h),oe=!1,K=!1,Ne(),s==="mask"&&se()};var Fe=null,We=null,de={top:0,left:0,width:0,height:0};let Ge=h=>{let I=H.width,C=H.height,y=0,R=0;for(let E=0;E<H.height;E++)for(let J=0;J<H.width;J++){const ue=(E*H.width+J)*4;H.data[ue+3]===h&&(I=Math.min(I,J),C=Math.min(C,E),y=Math.max(y,J),R=Math.max(R,E))}return{top:C,left:I,width:y-I,height:R-C}};function Qe(h,I){return new Promise(C=>{ie=new ImageData(H.width,H.height),ie.data.set(H.data);for(let R=0;R<ie.height;R++)for(let E=0;E<ie.width;E++){const J=(R*ie.width+E)*4,ue=H.data;var y=ie.data;ue[J+3]==I?y[J+3]=255:y[J+3]=0}ye=rt(ie),ye.addEventListener("load",()=>{const R=document.createElement("canvas");R.width=h.width,R.height=h.height,R.getContext("2d").drawImage(ye,de.left,h.top,h.width,h.height,0,0,h.width,h.height);var J=new Image;J.src=R.toDataURL(),C(J)})})}function Ve(h){let I=Z.map(C=>C.id);if(console.log("changed obj ids =",I),I.includes(h)){console.log("current_object_id is a chaged object");let C=Z.find(y=>y.id===h);console.log("current_obj =",C),de=C.pos,ne=C.img}else{de=Ge(h);async function C(){ne=await Qe(de,h)}C()}}function Me(h,I){const C=(Math.round(I)*H.width+Math.round(h))*4,y=H.data;console.log(`imageDataOriginal width and height: ${H.width}, ${H.height}`),console.log(`pixels length: ${y.length}`),console.log(`image space x and y: ${h}, ${I}`),console.log(`pixel index: ${C}`),console.log(`pixel value: ${y[C]}, ${y[C+1]}, ${y[C+2]}, ${y[C+3]}`);var R=y[C+3];if(Z.length>0)for(let E=Z.length-1;E>=0;E--){const{id:J,pos:ue}=Z[E];if(console.log(J,ue),h>=ue.left&&h<ue.left+ue.width&&I>=ue.top&&I<ue.top+ue.height){R=J;break}}return R}let Ee=h=>{h.preventDefault(),K=!0;const{x:I,y:C}=j(h);if(Fe=I,We=C,ae=Me(I,C),ae==0){console.log("no object is selected"),K=!1;return}Ve(ae),console.log("handle_drag_start: changed_objects",Z)},Ze=h=>{if(h.preventDefault(),!K)return;Oe(),g.drawing.clearRect(0,0,u,c),Ae();const{x:I,y:C}=j(h),y=I-Fe,R=C-We,E=de.left+y,J=de.top+R;ne&&ne.complete&&g.drawing.drawImage(ne,E,J)},He=h=>{O.width,O.height;let I=Z.map(y=>y.id);if(console.log("erase_object: before, changed obj ids =",I),I.includes(ae)){let y=Z.findLastIndex(R=>R.id===h);console.log("erase_object: findLastIndex, index =",y);for(let R=y;R>=0;R--)Z[R].id===h&&(Z.splice(R,1),console.log("erase_object: splice, i =",R))}console.log("erase_object: after, changed obj ids =",I);for(let y=0;y<O.height;y++)for(let R=0;R<O.width;R++){const E=(y*O.width+R)*4,J=H.data;var C=O.data;J[E+3]==h&&(C[E]=0,C[E+1]=0,C[E+2]=0,C[E+3]=0)}F=rt(O),F.addEventListener("load",()=>{Oe(),g.drawing.clearRect(0,0,u,c),console.log("erase_object: value_img_opaque loaded"),Ae()})},nt=h=>{if(h.stopPropagation(),h.preventDefault(),!K)return;K=!1,L=!0;const{x:I,y:C}=j(h),y=Math.round(I-Fe),R=Math.round(C-We),E=de.left+y,J=de.top+R;He(ae),Z.push({id:ae,pos:{left:E,top:J,width:de.width,height:de.height},img:ne}),l("select",{index:[y,R],value:ae}),console.log("handle_drag_end: dispatch (select)")},Pe=0,Ke=0,xe=0,$e=!1,et=async()=>{if(b&&me){const C=me?.getBoundingClientRect(),y=b[0]/b[1],R=C.width/C.height;n(5,$e=y<R)}if(u===Pe&&c===Ke&&xe===_)return;const h={width:u,height:c},I={height:_,width:_*(h.width/h.height)};await Promise.all([m(S.interface,h,I),m(S.drawing,h,I),m(S.temp,h,I),m(S.temp_fake,h,I),m(S.mask,h,I,!1)]),i||n(13,i=20*(h.width/I.width)),lt({once:!0}),setTimeout(()=>{Ke=c,Pe=u,xe=_},10),await Te(),tt()},m=async(h,I,C,y=!0)=>{if(!M)return;await Te();const R=window.devicePixelRatio||1;h.width=I.width*(y?R:1),h.height=I.height*(y?R:1);const E=h.getContext("2d");y&&E.scale(R,R),h.style.width=`${C.width}px`,h.style.height=`${C.height}px`},j=h=>{const I=S.interface.getBoundingClientRect();let C=h.clientX,y=h.clientY;return h.changedTouches&&h.changedTouches.length>0&&(C=h.changedTouches[0].clientX,y=h.changedTouches[0].clientY),{x:(C-I.left)/I.width*u,y:(y-I.top)/I.height*c}},q=(h,I)=>{x.update({x:h,y:I});const C=!x.isEnabled();(K&&!oe||C&&K)&&(oe=!0,A.push(x.brush.toObject())),oe&&(A.push(x.brush.toObject()),W({points:A,brush_color:a,brush_radius:i}),s==="mask"&&G({points:A,brush_color:a,brush_radius:i})),L=!0},W=({points:h,brush_color:I,brush_radius:C})=>{if(!h||h.length<2||(console.log("draw_points length",h.length),g.temp.lineJoin="round",g.temp.lineCap="round",g.temp.strokeStyle=I,g.temp.lineWidth=C,!h||h.length<2))return;console.log("draw_points length",h.length);let y=h[0],R=h[1];g.temp.moveTo(R.x,R.y),g.temp.beginPath();for(var E=1,J=h.length;E<J;E++){var ue=zt(y,R);g.temp.quadraticCurveTo(y.x,y.y,ue.x,ue.y),y=h[E],R=h[E+1]}g.temp.strokeStyle="red",g.temp.lineWidth=5,g.temp.strokeRect(y.x,y.y,50,50),console.log("drawing rect at ",y.x,y.y)},G=({points:h,brush_color:I,brush_radius:C})=>{if(!h||h.length<2)return;g.temp_fake.lineJoin="round",g.temp_fake.lineCap="round",g.temp_fake.strokeStyle="#fff",g.temp_fake.lineWidth=C;let y=h[0],R=h[1];g.temp_fake.moveTo(R.x,R.y),g.temp_fake.beginPath();for(var E=1,J=h.length;E<J;E++){var ue=zt(y,R);g.temp_fake.quadraticCurveTo(y.x,y.y,ue.x,ue.y),y=h[E],R=h[E+1]}g.temp_fake.strokeStyle="red",g.temp_fake.lineWidth=5,g.temp_fake.strokeRect(y.x,y.y,50,50),console.log("drawing rect at ",y.x,y.y)},se=()=>{A.length<1||(A.length=0,g.mask.drawImage(S.temp_fake,0,0,u,c),ke("save_mask_line"))},Ne=()=>{A.length<1||(w.push({points:A.slice(),brush_color:a,brush_radius:i}),s!=="mask"&&(A.length=0),g.drawing.drawImage(S.temp,0,0,u,c),ke("saveLine"))},ke=h=>{console.log(`trigger_on_change called from ${h}`);const I=d();l("change",I)};function tt(){return w=[],Oe(),n(4,he=0),!0}function Oe(){ee=!0,g.temp.clearRect(0,0,u,c),g.temp.fillStyle=s==="mask"?"transparent":"#FFFFFF",g.temp.fillRect(0,0,u,c),s==="mask"&&(g.temp_fake.clearRect(0,0,S.temp_fake.width,S.temp_fake.height),g.mask.clearRect(0,0,u,c),g.mask.fillStyle="#000",g.mask.fillRect(0,0,u,c))}let lt=({once:h=!1}={})=>{(L||ee)&&(x.getPointerCoordinates(),x.getBrushCoordinates(),L=!1,ee=!1),h||window.requestAnimationFrame(()=>{lt()})};function d(){return s==="mask"?S.mask.toDataURL("image/jpg"):S.drawing.toDataURL("image/jpg")}function Re(h){be.call(this,t,h)}function tn(h,I){N[h?"unshift":"push"](()=>{S[I]=h,n(2,S)})}function nn(h){N[h?"unshift":"push"](()=>{me=h,n(3,me)})}function ln(){z=this.offsetWidth,ce=this.offsetHeight,n(0,z),n(1,ce)}return t.$$set=h=>{"value"in h&&n(16,r=h.value),"value_img"in h&&n(17,o=h.value_img),"mode"in h&&n(18,s=h.mode),"brush_color"in h&&n(19,a=h.brush_color),"brush_radius"in h&&n(13,i=h.brush_radius),"source"in h&&n(20,f=h.source),"width"in h&&n(14,u=h.width),"height"in h&&n(15,c=h.height),"container_height"in h&&n(21,_=h.container_height),"shape"in h&&n(22,b=h.shape)},t.$$.update=()=>{t.$$.dirty[0]&4243456&&b&&(u||c)&&(console.log("shape and width or height"),console.log(b,u,c),n(14,u=b[0]),n(15,c=b[1])),t.$$.dirty[0]&3457024&&console.log("source = ",f,"mode = ",s,"width = ",u,"height = ",c,"container_height = ",_),t.$$.dirty[0]&134283264&&M&&!r&&tt(),t.$$.dirty[0]&196608&&(console.log("Compose.svelte: value changed = ",r),console.log("Compose.svelte: value_img.complete:",o.complete)),t.$$.dirty[0]&268443648&&x&&(De(),x.setRadius(i*.05)),t.$$.dirty[0]&49152&&(u||c)&&et(),t.$$.dirty[0]&8192},[z,ce,S,me,he,$e,U,k,Ye,Le,Ee,Ze,nt,i,u,c,r,o,s,a,f,_,b,qe,Ue,tt,d,M,x,Re,tn,nn,ln]}class $t extends ze{constructor(e){super(),je(this,e,Un,qn,Ce,{value:16,value_img:17,mode:18,brush_color:19,brush_radius:13,source:20,width:14,height:15,container_height:21,shape:22,clear_mask:23,undo:24,clear:25,get_image_data:26},null,[-1,-1,-1])}get clear_mask(){return this.$$.ctx[23]}get undo(){return this.$$.ctx[24]}get clear(){return this.$$.ctx[25]}get get_image_data(){return this.$$.ctx[26]}}function Dt(t){let e,n;return e=new it({props:{Icon:Rn,label:"Clear"}}),e.$on("click",t[3]),{c(){X(e.$$.fragment)},m(l,r){Y(e,l,r),n=!0},p:le,i(l){n||(v(e.$$.fragment,l),n=!0)},o(l){T(e.$$.fragment,l),n=!1},d(l){P(e,l)}}}function Fn(t){let e,n,l,r,o,s;n=new it({props:{Icon:pn,label:"Undo"}}),n.$on("click",t[2]);let a=t[0]&&Dt(t);return o=new it({props:{Icon:kn,label:"Remove Image"}}),o.$on("click",t[4]),{c(){e=re("div"),X(n.$$.fragment),l=$(),a&&a.c(),r=$(),X(o.$$.fragment),p(e,"class","svelte-s6ybro")},m(i,f){D(i,e,f),Y(n,e,null),ge(e,l),a&&a.m(e,null),ge(e,r),Y(o,e,null),s=!0},p(i,[f]){i[0]?a?(a.p(i,f),f&1&&v(a,1)):(a=Dt(i),a.c(),v(a,1),a.m(e,r)):a&&(pe(),T(a,1,1,()=>{a=null}),we())},i(i){s||(v(n.$$.fragment,i),v(a),v(o.$$.fragment,i),s=!0)},o(i){T(n.$$.fragment,i),T(a),T(o.$$.fragment,i),s=!1},d(i){i&&B(e),P(n),a&&a.d(),P(o)}}}function Wn(t,e,n){const l=Je();let{show_eraser:r=!1}=e;const o=()=>l("undo"),s=i=>{l("clear_mask"),i.stopPropagation()},a=i=>{l("remove_image"),i.stopPropagation()};return t.$$set=i=>{"show_eraser"in i&&n(0,r=i.show_eraser)},[r,l,o,s,a]}class dt extends ze{constructor(e){super(),je(this,e,Wn,Fn,Ce,{show_eraser:0})}}function Bt(t){let e,n,l,r,o,s;n=new it({props:{Icon:yn,label:"Use brush"}}),n.$on("click",t[10]);let a=t[5]&&Lt(t),i=t[3]!=="mask"&&Et(t);return{c(){e=re("span"),X(n.$$.fragment),l=$(),a&&a.c(),r=$(),i&&i.c(),o=Xe(),p(e,"class","brush svelte-p4aq0j")},m(f,u){D(f,e,u),Y(n,e,null),ge(e,l),a&&a.m(e,null),D(f,r,u),i&&i.m(f,u),D(f,o,u),s=!0},p(f,u){f[5]?a?a.p(f,u):(a=Lt(f),a.c(),a.m(e,null)):a&&(a.d(1),a=null),f[3]!=="mask"?i?(i.p(f,u),u&8&&v(i,1)):(i=Et(f),i.c(),v(i,1),i.m(o.parentNode,o)):i&&(pe(),T(i,1,1,()=>{i=null}),we())},i(f){s||(v(n.$$.fragment,f),v(i),s=!0)},o(f){T(n.$$.fragment,f),T(i),s=!1},d(f){f&&B(e),P(n),a&&a.d(),f&&B(r),i&&i.d(f),f&&B(o)}}}function Lt(t){let e,n,l,r,o;return{c(){e=re("input"),p(e,"aria-label","Brush radius"),p(e,"type","range"),p(e,"min",n=.5*(t[2]/t[7])),p(e,"max",l=75*(t[2]/t[7])),p(e,"class","svelte-p4aq0j")},m(s,a){D(s,e,a),ut(e,t[0]),r||(o=[Q(e,"change",t[11]),Q(e,"input",t[11])],r=!0)},p(s,a){a&132&&n!==(n=.5*(s[2]/s[7]))&&p(e,"min",n),a&132&&l!==(l=75*(s[2]/s[7]))&&p(e,"max",l),a&1&&ut(e,s[0])},d(s){s&&B(e),r=!1,mt(o)}}}function Et(t){let e,n,l,r;n=new it({props:{Icon:An,label:"Select brush color"}}),n.$on("click",t[12]);let o=t[6]&&St(t);return{c(){e=re("span"),X(n.$$.fragment),l=$(),o&&o.c(),p(e,"class","col svelte-p4aq0j")},m(s,a){D(s,e,a),Y(n,e,null),ge(e,l),o&&o.m(e,null),r=!0},p(s,a){s[6]?o?o.p(s,a):(o=St(s),o.c(),o.m(e,null)):o&&(o.d(1),o=null)},i(s){r||(v(n.$$.fragment,s),r=!0)},o(s){T(n.$$.fragment,s),r=!1},d(s){s&&B(e),P(n),o&&o.d()}}}function St(t){let e,n,l;return{c(){e=re("input"),p(e,"aria-label","Brush color"),p(e,"type","color"),p(e,"class","svelte-p4aq0j")},m(r,o){D(r,e,o),ut(e,t[1]),n||(l=Q(e,"input",t[13]),n=!0)},p(r,o){o&2&&ut(e,r[1])},d(r){r&&B(e),n=!1,l()}}}function Hn(t){let e,n,l=t[4]!=="compose"&&Bt(t);return{c(){e=re("div"),l&&l.c(),p(e,"class","wrap svelte-p4aq0j")},m(r,o){D(r,e,o),l&&l.m(e,null),n=!0},p(r,[o]){r[4]!=="compose"?l?(l.p(r,o),o&16&&v(l,1)):(l=Bt(r),l.c(),v(l,1),l.m(e,null)):l&&(pe(),T(l,1,1,()=>{l=null}),we())},i(r){n||(v(l),n=!0)},o(r){T(l),n=!1},d(r){r&&B(e),l&&l.d()}}}function Nn(t,e,n){let l;Je();let r=!1,o=!1,{brush_radius:s=20}=e,{brush_color:a="#000"}=e,{container_height:i}=e,{img_width:f}=e,{img_height:u}=e,{mode:c="other"}=e,{tool:_="others"}=e;const b=()=>n(5,r=!r);function M(){s=rn(this.value),n(0,s)}const z=()=>n(6,o=!o);function ce(){a=this.value,n(1,a)}return t.$$set=U=>{"brush_radius"in U&&n(0,s=U.brush_radius),"brush_color"in U&&n(1,a=U.brush_color),"container_height"in U&&n(8,i=U.container_height),"img_width"in U&&n(2,f=U.img_width),"img_height"in U&&n(9,u=U.img_height),"mode"in U&&n(3,c=U.mode),"tool"in U&&n(4,_=U.tool)},t.$$.update=()=>{t.$$.dirty&772&&n(7,l=i*(f/u))},[s,a,f,c,_,r,o,l,i,u,b,M,z,ce]}class bt extends ze{constructor(e){super(),je(this,e,Nn,Hn,Ce,{brush_radius:0,brush_color:1,container_height:8,img_width:2,img_height:9,mode:3,tool:4})}}function Xn(t){let e,n,l,r;return{c(){e=re("img"),Ie(e.src,n=t[0].image||t[0])||p(e,"src",n),p(e,"alt",""),p(e,"class","svelte-p3y7hu"),V(e,"webcam",t[5]==="webcam"&&t[9]),V(e,"selectable",t[10])},m(o,s){D(o,e,s),l||(r=Q(e,"click",t[31]),l=!0)},p(o,s){s[0]&1&&!Ie(e.src,n=o[0].image||o[0])&&p(e,"src",n),s[0]&544&&V(e,"webcam",o[5]==="webcam"&&o[9]),s[0]&1024&&V(e,"selectable",o[10])},i:le,o:le,d(o){o&&B(e),l=!1,r()}}}function Yn(t){let e=t[22],n,l,r,o=qt(t),s=t[19]>0&&Ut(t);return{c(){o.c(),n=$(),s&&s.c(),l=Xe()},m(a,i){o.m(a,i),D(a,n,i),s&&s.m(a,i),D(a,l,i),r=!0},p(a,i){i[0]&4194304&&Ce(e,e=a[22])?(o.d(1),o=qt(a),o.c(),o.m(n.parentNode,n)):o.p(a,i),a[19]>0?s?(s.p(a,i),i[0]&524288&&v(s,1)):(s=Ut(a),s.c(),v(s,1),s.m(l.parentNode,l)):s&&(pe(),T(s,1,1,()=>{s=null}),we())},i(a){r||(v(s),r=!0)},o(a){T(s),r=!1},d(a){o.d(a),a&&B(n),s&&s.d(a),a&&B(l)}}}function Pn(t){let e,n,l,r,o,s,a;return e=new ft({props:{editable:!0}}),e.$on("edit",t[60]),e.$on("clear",t[25]),{c(){X(e.$$.fragment),n=$(),l=re("img"),Ie(l.src,r=t[0])||p(l,"src",r),p(l,"alt",""),p(l,"class","svelte-p3y7hu"),V(l,"selectable",t[10]),V(l,"webcam",t[5]==="webcam"&&t[9])},m(i,f){Y(e,i,f),D(i,n,f),D(i,l,f),o=!0,s||(a=Q(l,"click",t[31]),s=!0)},p(i,f){(!o||f[0]&1&&!Ie(l.src,r=i[0]))&&p(l,"src",r),(!o||f[0]&1024)&&V(l,"selectable",i[10]),(!o||f[0]&544)&&V(l,"webcam",i[5]==="webcam"&&i[9])},i(i){o||(v(e.$$.fragment,i),o=!0)},o(i){T(e.$$.fragment,i),o=!1},d(i){P(e,i),i&&B(n),i&&B(l),s=!1,a()}}}function On(t){let e,n,l,r,o={image:t[0]};return e=new Kt({props:o}),t[58](e),e.$on("crop",t[26]),l=new ft({}),l.$on("clear",t[59]),{c(){X(e.$$.fragment),n=$(),X(l.$$.fragment)},m(s,a){Y(e,s,a),D(s,n,a),Y(l,s,a),r=!0},p(s,a){const i={};a[0]&1&&(i.image=s[0]),e.$set(i)},i(s){r||(v(e.$$.fragment,s),v(l.$$.fragment,s),r=!0)},o(s){T(e.$$.fragment,s),T(l.$$.fragment,s),r=!1},d(s){t[58](null),P(e,s),s&&B(n),P(l,s)}}}function Jn(t){let e,n,l=t[5]==="webcam"&&!t[22]&&Wt(t);return{c(){l&&l.c(),e=Xe()},m(r,o){l&&l.m(r,o),D(r,e,o),n=!0},p(r,o){r[5]==="webcam"&&!r[22]?l?(l.p(r,o),o[0]&4194336&&v(l,1)):(l=Wt(r),l.c(),v(l,1),l.m(e.parentNode,e)):l&&(pe(),T(l,1,1,()=>{l=null}),we())},i(r){n||(v(l),n=!0)},o(r){T(l),n=!1},d(r){l&&l.d(r),r&&B(e)}}}function Gn(t){let e,n,l,r,o,s,a,i,f,u,c;e=new dt({}),e.$on("undo",t[47]),e.$on("remove_image",t[29]);let _=t[1]==="color-sketch"&&Ht(t);function b(g){t[50](g)}function M(g){t[51](g)}let z={value:t[0],mode:t[14],width:t[19]||t[21],height:t[18]||t[15],container_height:t[13]||t[15],shape:t[6]};t[2]!==void 0&&(z.brush_radius=t[2]),t[23]!==void 0&&(z.brush_color=t[23]),r=new gt({props:z}),N.push(()=>fe(r,"brush_radius",b)),N.push(()=>fe(r,"brush_color",M)),t[52](r),r.$on("change",t[26]),r.$on("clear",t[29]);function ce(g){t[53](g)}function U(g){t[54](g)}let S={value:t[0],mode:t[14],width:t[19]||t[21],height:t[18]||t[15],container_height:t[13]||t[15],shape:t[6]};return t[2]!==void 0&&(S.brush_radius=t[2]),t[23]!==void 0&&(S.brush_color=t[23]),i=new $t({props:S}),N.push(()=>fe(i,"brush_radius",ce)),N.push(()=>fe(i,"brush_color",U)),t[55](i),i.$on("change",t[26]),i.$on("clear",t[29]),{c(){X(e.$$.fragment),n=$(),_&&_.c(),l=$(),X(r.$$.fragment),a=$(),X(i.$$.fragment)},m(g,A){Y(e,g,A),D(g,n,A),_&&_.m(g,A),D(g,l,A),Y(r,g,A),D(g,a,A),Y(i,g,A),c=!0},p(g,A){g[1]==="color-sketch"?_?(_.p(g,A),A[0]&2&&v(_,1)):(_=Ht(g),_.c(),v(_,1),_.m(l.parentNode,l)):_&&(pe(),T(_,1,1,()=>{_=null}),we());const w={};A[0]&1&&(w.value=g[0]),A[0]&16384&&(w.mode=g[14]),A[0]&2621440&&(w.width=g[19]||g[21]),A[0]&294912&&(w.height=g[18]||g[15]),A[0]&40960&&(w.container_height=g[13]||g[15]),A[0]&64&&(w.shape=g[6]),!o&&A[0]&4&&(o=!0,w.brush_radius=g[2],_e(()=>o=!1)),!s&&A[0]&8388608&&(s=!0,w.brush_color=g[23],_e(()=>s=!1)),r.$set(w);const L={};A[0]&1&&(L.value=g[0]),A[0]&16384&&(L.mode=g[14]),A[0]&2621440&&(L.width=g[19]||g[21]),A[0]&294912&&(L.height=g[18]||g[15]),A[0]&40960&&(L.container_height=g[13]||g[15]),A[0]&64&&(L.shape=g[6]),!f&&A[0]&4&&(f=!0,L.brush_radius=g[2],_e(()=>f=!1)),!u&&A[0]&8388608&&(u=!0,L.brush_color=g[23],_e(()=>u=!1)),i.$set(L)},i(g){c||(v(e.$$.fragment,g),v(_),v(r.$$.fragment,g),v(i.$$.fragment,g),c=!0)},o(g){T(e.$$.fragment,g),T(_),T(r.$$.fragment,g),T(i.$$.fragment,g),c=!1},d(g){P(e,g),g&&B(n),_&&_.d(g),g&&B(l),t[52](null),P(r,g),g&&B(a),t[55](null),P(i,g)}}}function Qn(t){let e,n,l;function r(s){t[46](s)}let o={filetype:"image/*",include_file_metadata:!1,disable_click:!!t[0],$$slots:{default:[nl]},$$scope:{ctx:t}};return t[12]!==void 0&&(o.dragging=t[12]),e=new vn({props:o}),N.push(()=>fe(e,"dragging",r)),e.$on("load",t[24]),{c(){X(e.$$.fragment)},m(s,a){Y(e,s,a),l=!0},p(s,a){const i={};a[0]&1&&(i.disable_click=!!s[0]),a[0]&16772839|a[2]&128&&(i.$$scope={dirty:a,ctx:s}),!n&&a[0]&4096&&(n=!0,i.dragging=s[12],_e(()=>n=!1)),e.$set(i)},i(s){l||(v(e.$$.fragment,s),l=!0)},o(s){T(e.$$.fragment,s),l=!1},d(s){P(e,s)}}}function qt(t){let e,n,l,r;return{c(){e=re("img"),p(e,"class","absolute-img svelte-p3y7hu"),Ie(e.src,n=t[22]||t[0]?.image||t[0])||p(e,"src",n),p(e,"alt",""),V(e,"webcam",t[5]==="webcam"&&t[9])},m(o,s){D(o,e,s),t[61](e),l||(r=Q(e,"load",t[28]),l=!0)},p(o,s){s[0]&4194305&&!Ie(e.src,n=o[22]||o[0]?.image||o[0])&&p(e,"src",n),s[0]&544&&V(e,"webcam",o[5]==="webcam"&&o[9])},d(o){o&&B(e),t[61](null),l=!1,r()}}}function Ut(t){let e,n,l,r,o,s,a,i;function f(b){t[63](b)}function u(b){t[64](b)}let c={value:t[0],mode:t[14],width:t[19]||t[21],height:t[18]||t[15],container_height:t[13]||t[15],value_img:t[20],source:t[5]};t[2]!==void 0&&(c.brush_radius=t[2]),t[23]!==void 0&&(c.brush_color=t[23]),e=new gt({props:c}),t[62](e),N.push(()=>fe(e,"brush_radius",f)),N.push(()=>fe(e,"brush_color",u)),e.$on("change",t[26]),o=new dt({}),o.$on("undo",t[65]),o.$on("remove_image",t[29]);let _=(t[1]==="color-sketch"||t[1]==="sketch"||t[1]==="compose")&&Ft(t);return{c(){X(e.$$.fragment),r=$(),X(o.$$.fragment),s=$(),_&&_.c(),a=Xe()},m(b,M){Y(e,b,M),D(b,r,M),Y(o,b,M),D(b,s,M),_&&_.m(b,M),D(b,a,M),i=!0},p(b,M){const z={};M[0]&1&&(z.value=b[0]),M[0]&16384&&(z.mode=b[14]),M[0]&2621440&&(z.width=b[19]||b[21]),M[0]&294912&&(z.height=b[18]||b[15]),M[0]&40960&&(z.container_height=b[13]||b[15]),M[0]&1048576&&(z.value_img=b[20]),M[0]&32&&(z.source=b[5]),!n&&M[0]&4&&(n=!0,z.brush_radius=b[2],_e(()=>n=!1)),!l&&M[0]&8388608&&(l=!0,z.brush_color=b[23],_e(()=>l=!1)),e.$set(z),b[1]==="color-sketch"||b[1]==="sketch"||b[1]==="compose"?_?(_.p(b,M),M[0]&2&&v(_,1)):(_=Ft(b),_.c(),v(_,1),_.m(a.parentNode,a)):_&&(pe(),T(_,1,1,()=>{_=null}),we())},i(b){i||(v(e.$$.fragment,b),v(o.$$.fragment,b),v(_),i=!0)},o(b){T(e.$$.fragment,b),T(o.$$.fragment,b),T(_),i=!1},d(b){t[62](null),P(e,b),b&&B(r),P(o,b),b&&B(s),_&&_.d(b),b&&B(a)}}}function Ft(t){let e,n,l,r;function o(i){t[66](i)}function s(i){t[67](i)}let a={container_height:t[13]||t[15],img_width:t[19]||t[21],img_height:t[18]||t[15],mode:t[14]};return t[2]!==void 0&&(a.brush_radius=t[2]),t[23]!==void 0&&(a.brush_color=t[23]),e=new bt({props:a}),N.push(()=>fe(e,"brush_radius",o)),N.push(()=>fe(e,"brush_color",s)),{c(){X(e.$$.fragment)},m(i,f){Y(e,i,f),r=!0},p(i,f){const u={};f[0]&40960&&(u.container_height=i[13]||i[15]),f[0]&2621440&&(u.img_width=i[19]||i[21]),f[0]&294912&&(u.img_height=i[18]||i[15]),f[0]&16384&&(u.mode=i[14]),!n&&f[0]&4&&(n=!0,u.brush_radius=i[2],_e(()=>n=!1)),!l&&f[0]&8388608&&(l=!0,u.brush_color=i[23],_e(()=>l=!1)),e.$set(u)},i(i){r||(v(e.$$.fragment,i),r=!0)},o(i){T(e.$$.fragment,i),r=!1},d(i){P(e,i)}}}function Wt(t){let e,n;return e=new wn({props:{streaming:t[7],pending:t[8],mirror_webcam:t[9]}}),e.$on("capture",t[56]),e.$on("stream",t[26]),e.$on("error",t[57]),{c(){X(e.$$.fragment)},m(l,r){Y(e,l,r),n=!0},p(l,r){const o={};r[0]&128&&(o.streaming=l[7]),r[0]&256&&(o.pending=l[8]),r[0]&512&&(o.mirror_webcam=l[9]),e.$set(o)},i(l){n||(v(e.$$.fragment,l),n=!0)},o(l){T(e.$$.fragment,l),n=!1},d(l){P(e,l)}}}function Ht(t){let e,n,l,r;function o(i){t[48](i)}function s(i){t[49](i)}let a={container_height:t[13]||t[15],img_width:t[19]||t[21],img_height:t[18]||t[15]};return t[2]!==void 0&&(a.brush_radius=t[2]),t[23]!==void 0&&(a.brush_color=t[23]),e=new bt({props:a}),N.push(()=>fe(e,"brush_radius",o)),N.push(()=>fe(e,"brush_color",s)),{c(){X(e.$$.fragment)},m(i,f){Y(e,i,f),r=!0},p(i,f){const u={};f[0]&40960&&(u.container_height=i[13]||i[15]),f[0]&2621440&&(u.img_width=i[19]||i[21]),f[0]&294912&&(u.img_height=i[18]||i[15]),!n&&f[0]&4&&(n=!0,u.brush_radius=i[2],_e(()=>n=!1)),!l&&f[0]&8388608&&(l=!0,u.brush_color=i[23],_e(()=>l=!1)),e.$set(u)},i(i){r||(v(e.$$.fragment,i),r=!0)},o(i){T(e.$$.fragment,i),r=!1},d(i){P(e,i)}}}function Vn(t){let e,n,l,r;return{c(){e=re("img"),Ie(e.src,n=t[0].image||t[0])||p(e,"src",n),p(e,"alt","hello"),p(e,"class","svelte-p3y7hu"),V(e,"webcam",t[5]==="webcam"&&t[9]),V(e,"selectable",t[10])},m(o,s){D(o,e,s),l||(r=Q(e,"click",t[31]),l=!0)},p(o,s){s[0]&1&&!Ie(e.src,n=o[0].image||o[0])&&p(e,"src",n),s[0]&544&&V(e,"webcam",o[5]==="webcam"&&o[9]),s[0]&1024&&V(e,"selectable",o[10])},i:le,o:le,d(o){o&&B(e),l=!1,r()}}}function Zn(t){let e=t[22],n,l,r,o=Nt(t),s=t[19]>0&&Xt(t);return{c(){o.c(),n=$(),s&&s.c(),l=Xe()},m(a,i){o.m(a,i),D(a,n,i),s&&s.m(a,i),D(a,l,i),r=!0},p(a,i){i[0]&4194304&&Ce(e,e=a[22])?(o.d(1),o=Nt(a),o.c(),o.m(n.parentNode,n)):o.p(a,i),a[19]>0?s?(s.p(a,i),i[0]&524288&&v(s,1)):(s=Xt(a),s.c(),v(s,1),s.m(l.parentNode,l)):s&&(pe(),T(s,1,1,()=>{s=null}),we())},i(a){r||(v(s),r=!0)},o(a){T(s),r=!1},d(a){o.d(a),a&&B(n),s&&s.d(a),a&&B(l)}}}function Kn(t){let e,n,l,r,o,s,a;return e=new ft({props:{editable:!0}}),e.$on("edit",t[35]),e.$on("clear",t[25]),{c(){X(e.$$.fragment),n=$(),l=re("img"),Ie(l.src,r=t[0])||p(l,"src",r),p(l,"alt",""),p(l,"class","svelte-p3y7hu"),V(l,"scale-x-[-1]",t[5]==="webcam"&&t[9]),V(l,"selectable",t[10])},m(i,f){Y(e,i,f),D(i,n,f),D(i,l,f),o=!0,s||(a=Q(l,"click",t[31]),s=!0)},p(i,f){(!o||f[0]&1&&!Ie(l.src,r=i[0]))&&p(l,"src",r),(!o||f[0]&544)&&V(l,"scale-x-[-1]",i[5]==="webcam"&&i[9]),(!o||f[0]&1024)&&V(l,"selectable",i[10])},i(i){o||(v(e.$$.fragment,i),o=!0)},o(i){T(e.$$.fragment,i),o=!1},d(i){P(e,i),i&&B(n),i&&B(l),s=!1,a()}}}function xn(t){let e,n,l,r,o={image:t[0]};return e=new Kt({props:o}),t[33](e),e.$on("crop",t[26]),l=new ft({}),l.$on("clear",t[34]),{c(){X(e.$$.fragment),n=$(),X(l.$$.fragment)},m(s,a){Y(e,s,a),D(s,n,a),Y(l,s,a),r=!0},p(s,a){const i={};a[0]&1&&(i.image=s[0]),e.$set(i)},i(s){r||(v(e.$$.fragment,s),v(l.$$.fragment,s),r=!0)},o(s){T(e.$$.fragment,s),T(l.$$.fragment,s),r=!1},d(s){t[33](null),P(e,s),s&&B(n),P(l,s)}}}function $n(t){let e;const n=t[32].default,l=on(n,t,t[69],null);return{c(){l&&l.c()},m(r,o){l&&l.m(r,o),e=!0},p(r,o){l&&l.p&&(!e||o[2]&128)&&an(l,n,r,r[69],e?fn(n,r[69],o,null):un(r[69]),null)},i(r){e||(v(l,r),e=!0)},o(r){T(l,r),e=!1},d(r){l&&l.d(r)}}}function Nt(t){let e,n,l,r;return{c(){e=re("img"),p(e,"class","absolute-img svelte-p3y7hu"),Ie(e.src,n=t[22]||t[0]?.image||t[0])||p(e,"src",n),p(e,"alt",""),V(e,"webcam",t[5]==="webcam"&&t[9])},m(o,s){D(o,e,s),t[36](e),l||(r=Q(e,"load",t[28]),l=!0)},p(o,s){s[0]&4194305&&!Ie(e.src,n=o[22]||o[0]?.image||o[0])&&p(e,"src",n),s[0]&544&&V(e,"webcam",o[5]==="webcam"&&o[9])},d(o){o&&B(e),t[36](null),l=!1,r()}}}function Xt(t){let e,n,l,r,o,s,a;const i=[tl,el],f=[];function u(_,b){return _[1]==="compose"?0:1}e=u(t),n=f[e]=i[e](t),r=new dt({props:{show_eraser:t[20]}}),r.$on("undo",t[43]),r.$on("clear_mask",t[30]),r.$on("remove_image",t[29]);let c=(t[1]==="color-sketch"||t[1]==="sketch"||t[1]==="compose")&&Yt(t);return{c(){n.c(),l=$(),X(r.$$.fragment),o=$(),c&&c.c(),s=Xe()},m(_,b){f[e].m(_,b),D(_,l,b),Y(r,_,b),D(_,o,b),c&&c.m(_,b),D(_,s,b),a=!0},p(_,b){let M=e;e=u(_),e===M?f[e].p(_,b):(pe(),T(f[M],1,1,()=>{f[M]=null}),we(),n=f[e],n?n.p(_,b):(n=f[e]=i[e](_),n.c()),v(n,1),n.m(l.parentNode,l));const z={};b[0]&1048576&&(z.show_eraser=_[20]),r.$set(z),_[1]==="color-sketch"||_[1]==="sketch"||_[1]==="compose"?c?(c.p(_,b),b[0]&2&&v(c,1)):(c=Yt(_),c.c(),v(c,1),c.m(s.parentNode,s)):c&&(pe(),T(c,1,1,()=>{c=null}),we())},i(_){a||(v(n),v(r.$$.fragment,_),v(c),a=!0)},o(_){T(n),T(r.$$.fragment,_),T(c),a=!1},d(_){f[e].d(_),_&&B(l),P(r,_),_&&B(o),c&&c.d(_),_&&B(s)}}}function el(t){let e,n,l,r;function o(i){t[41](i)}function s(i){t[42](i)}let a={value:t[0],mode:t[14],width:t[19]||t[21],height:t[18]||t[15],container_height:t[13]||t[15],value_img:t[20],source:t[5],shape:t[6]};return t[2]!==void 0&&(a.brush_radius=t[2]),t[23]!==void 0&&(a.brush_color=t[23]),e=new gt({props:a}),t[40](e),N.push(()=>fe(e,"brush_radius",o)),N.push(()=>fe(e,"brush_color",s)),e.$on("change",t[26]),e.$on("select",t[27]),{c(){X(e.$$.fragment)},m(i,f){Y(e,i,f),r=!0},p(i,f){const u={};f[0]&1&&(u.value=i[0]),f[0]&16384&&(u.mode=i[14]),f[0]&2621440&&(u.width=i[19]||i[21]),f[0]&294912&&(u.height=i[18]||i[15]),f[0]&40960&&(u.container_height=i[13]||i[15]),f[0]&1048576&&(u.value_img=i[20]),f[0]&32&&(u.source=i[5]),f[0]&64&&(u.shape=i[6]),!n&&f[0]&4&&(n=!0,u.brush_radius=i[2],_e(()=>n=!1)),!l&&f[0]&8388608&&(l=!0,u.brush_color=i[23],_e(()=>l=!1)),e.$set(u)},i(i){r||(v(e.$$.fragment,i),r=!0)},o(i){T(e.$$.fragment,i),r=!1},d(i){t[40](null),P(e,i)}}}function tl(t){let e,n,l,r;function o(i){t[38](i)}function s(i){t[39](i)}let a={value:t[0],mode:t[14],width:t[19]||t[21],height:t[18]||t[15],container_height:t[13]||t[15],value_img:t[20],source:t[5],shape:t[6]};return t[2]!==void 0&&(a.brush_radius=t[2]),t[23]!==void 0&&(a.brush_color=t[23]),e=new $t({props:a}),t[37](e),N.push(()=>fe(e,"brush_radius",o)),N.push(()=>fe(e,"brush_color",s)),e.$on("change",t[26]),e.$on("select",t[27]),{c(){X(e.$$.fragment)},m(i,f){Y(e,i,f),r=!0},p(i,f){const u={};f[0]&1&&(u.value=i[0]),f[0]&16384&&(u.mode=i[14]),f[0]&2621440&&(u.width=i[19]||i[21]),f[0]&294912&&(u.height=i[18]||i[15]),f[0]&40960&&(u.container_height=i[13]||i[15]),f[0]&1048576&&(u.value_img=i[20]),f[0]&32&&(u.source=i[5]),f[0]&64&&(u.shape=i[6]),!n&&f[0]&4&&(n=!0,u.brush_radius=i[2],_e(()=>n=!1)),!l&&f[0]&8388608&&(l=!0,u.brush_color=i[23],_e(()=>l=!1)),e.$set(u)},i(i){r||(v(e.$$.fragment,i),r=!0)},o(i){T(e.$$.fragment,i),r=!1},d(i){t[37](null),P(e,i)}}}function Yt(t){let e,n,l,r;function o(i){t[44](i)}function s(i){t[45](i)}let a={container_height:t[13]||t[15],img_width:t[19]||t[21],img_height:t[18]||t[15],mode:t[14],tool:t[1]};return t[2]!==void 0&&(a.brush_radius=t[2]),t[23]!==void 0&&(a.brush_color=t[23]),e=new bt({props:a}),N.push(()=>fe(e,"brush_radius",o)),N.push(()=>fe(e,"brush_color",s)),{c(){X(e.$$.fragment)},m(i,f){Y(e,i,f),r=!0},p(i,f){const u={};f[0]&40960&&(u.container_height=i[13]||i[15]),f[0]&2621440&&(u.img_width=i[19]||i[21]),f[0]&294912&&(u.img_height=i[18]||i[15]),f[0]&16384&&(u.mode=i[14]),f[0]&2&&(u.tool=i[1]),!n&&f[0]&4&&(n=!0,u.brush_radius=i[2],_e(()=>n=!1)),!l&&f[0]&8388608&&(l=!0,u.brush_color=i[23],_e(()=>l=!1)),e.$set(u)},i(i){r||(v(e.$$.fragment,i),r=!0)},o(i){T(e.$$.fragment,i),r=!1},d(i){P(e,i)}}}function nl(t){let e,n,l,r;const o=[$n,xn,Kn,Zn,Vn],s=[];function a(i,f){return i[0]===null&&!i[22]||i[7]?0:i[1]==="select"?1:i[1]==="editor"?2:(i[1]==="sketch"||i[1]==="compose"||i[1]==="color-sketch")&&(i[0]!==null||i[22])?3:4}return e=a(t),n=s[e]=o[e](t),{c(){n.c(),l=Xe()},m(i,f){s[e].m(i,f),D(i,l,f),r=!0},p(i,f){let u=e;e=a(i),e===u?s[e].p(i,f):(pe(),T(s[u],1,1,()=>{s[u]=null}),we(),n=s[e],n?n.p(i,f):(n=s[e]=o[e](i),n.c()),v(n,1),n.m(l.parentNode,l))},i(i){r||(v(n),r=!0)},o(i){T(n),r=!1},d(i){s[e].d(i),i&&B(l)}}}function ll(t){let e,n,l,r,o,s,a;e=new dn({props:{show_label:t[4],Icon:t[5]==="canvas"?wt:pt,label:t[3]||(t[5]==="canvas"?"Sketch":"Image")}});const i=[Qn,Gn,Jn,On,Pn,Yn,Xn],f=[];function u(c,_){return c[5]==="upload"?0:c[5]==="canvas"?1:c[0]===null&&!c[22]||c[7]?2:c[1]==="select"?3:c[1]==="editor"?4:(c[1]==="sketch"||c[1]==="compose"||c[1]==="color-sketch")&&(c[0]!==null||c[22])?5:6}return r=u(t),o=f[r]=i[r](t),{c(){X(e.$$.fragment),n=$(),l=re("div"),o.c(),p(l,"data-testid","image"),p(l,"class","image-container svelte-p3y7hu"),st(()=>t[68].call(l))},m(c,_){Y(e,c,_),D(c,n,_),D(c,l,_),f[r].m(l,null),s=ht(l,t[68].bind(l)),a=!0},p(c,_){const b={};_[0]&16&&(b.show_label=c[4]),_[0]&32&&(b.Icon=c[5]==="canvas"?wt:pt),_[0]&40&&(b.label=c[3]||(c[5]==="canvas"?"Sketch":"Image")),e.$set(b);let M=r;r=u(c),r===M?f[r].p(c,_):(pe(),T(f[M],1,1,()=>{f[M]=null}),we(),o=f[r],o?o.p(c,_):(o=f[r]=i[r](c),o.c()),v(o,1),o.m(l,null))},i(c){a||(v(e.$$.fragment,c),v(o),a=!0)},o(c){T(e.$$.fragment,c),T(o),a=!1},d(c){P(e,c),c&&B(n),c&&B(l),f[r].d(),s()}}}function il(t,e,n){let l,{$$slots:r={},$$scope:o}=e,{value:s}=e,{label:a=void 0}=e,{show_label:i}=e,{source:f="upload"}=e,{tool:u="editor"|"compose"}=e,{shape:c}=e,{streaming:_=!1}=e,{pending:b=!1}=e,{mirror_webcam:M}=e,{brush_radius:z}=e,{selectable:ce=!1}=e,U,S,g;s&&(f==="upload"||f==="webcam")&&(u==="sketch"||u==="compose")&&(s={image:s,mask:null});function A({detail:d}){console.log("handle_upload container_height:",O),console.log("handle_upload max_height:",ne),u==="color-sketch"?n(22,ie=d):n(0,s=(f==="upload"||f==="webcam")&&(u==="sketch"||u==="compose")?{image:d,mask:null}:d),oe("upload",d)}function w({detail:d}){n(0,s=null),n(22,ie=void 0),oe("clear")}async function L({detail:d},Re){F==="mask"?f==="webcam"&&Re?n(0,s={image:d,mask:null}):n(0,s={image:typeof s=="string"?s:s?.image||null,mask:d}):(f==="upload"||f==="webcam")&&(u==="sketch"||u==="compose")?n(0,s={image:d,mask:null}):n(0,s=d),await Te(),oe(_?"stream":"edit"),console.log("image.svelte handle_save source =",f,"value:",s)}async function ee({detail:d}){await Te(),oe("select",d),console.log("image.svelte handle_select source =",f,"detail:",d)}const oe=Je();let K=!1;function x(d){const Re=d.currentTarget;n(19,H=Re.naturalWidth),n(18,he=Re.naturalHeight),n(13,O=Re.getBoundingClientRect().height),console.log("image.svelte handle_image_load source:",f),console.log("image.svelte handle_image_load tool:",u),console.log("image.svelte handle_image_load img_width:",H),console.log("image.svelte handle_image_load img_height:",he),console.log("image.svelte handle_image_load container_height:",O),console.log(d),console.log(Re)}async function me(){U.clear(),await Te(),n(0,s=null),n(22,ie=void 0)}async function te(){U.clear_mask(),await Te()}let he=0,H=0,O=0,F,Z,ne,ae,ie;ct(async()=>{console.log("image.svelte onMount source:",f),console.log("image.svelte onMount tool:",u),console.log("onMount container_height:",O),console.log("onMount max_height:",ne),u==="color-sketch"&&s&&typeof s=="string"&&(n(22,ie=s),await Te())});const ye=d=>{let Re=zn(d);Re&&oe("select",{index:Re,value:null})};function Ae(d){N[d?"unshift":"push"](()=>{g=d,n(11,g),n(0,s)})}const De=d=>(w(d),n(1,u="editor")),Se=()=>n(1,u="select");function qe(d){N[d?"unshift":"push"](()=>{Z=d,n(20,Z)})}function Ue(d){N[d?"unshift":"push"](()=>{S=d,n(17,S)})}function Be(d){z=d,n(2,z)}function k(d){l=d,n(23,l),n(14,F),n(5,f),n(1,u)}function Ye(d){N[d?"unshift":"push"](()=>{U=d,n(16,U)})}function Le(d){z=d,n(2,z)}function Fe(d){l=d,n(23,l),n(14,F),n(5,f),n(1,u)}const We=()=>U.undo();function de(d){z=d,n(2,z)}function Ge(d){l=d,n(23,l),n(14,F),n(5,f),n(1,u)}function Qe(d){K=d,n(12,K)}const Ve=()=>U.undo();function Me(d){z=d,n(2,z)}function Ee(d){l=d,n(23,l),n(14,F),n(5,f),n(1,u)}function Ze(d){z=d,n(2,z)}function He(d){l=d,n(23,l),n(14,F),n(5,f),n(1,u)}function nt(d){N[d?"unshift":"push"](()=>{U=d,n(16,U)})}function Pe(d){z=d,n(2,z)}function Ke(d){l=d,n(23,l),n(14,F),n(5,f),n(1,u)}function xe(d){N[d?"unshift":"push"](()=>{S=d,n(17,S)})}const $e=d=>u==="color-sketch"?A(d):L(d,!0);function et(d){be.call(this,t,d)}function m(d){N[d?"unshift":"push"](()=>{g=d,n(11,g),n(0,s)})}const j=d=>(w(d),n(1,u="editor")),q=()=>n(1,u="select");function W(d){N[d?"unshift":"push"](()=>{Z=d,n(20,Z)})}function G(d){N[d?"unshift":"push"](()=>{U=d,n(16,U)})}function se(d){z=d,n(2,z)}function Ne(d){l=d,n(23,l),n(14,F),n(5,f),n(1,u)}const ke=()=>U.undo();function tt(d){z=d,n(2,z)}function Oe(d){l=d,n(23,l),n(14,F),n(5,f),n(1,u)}function lt(){ne=this.offsetHeight,ae=this.offsetWidth,n(15,ne),n(21,ae)}return t.$$set=d=>{"value"in d&&n(0,s=d.value),"label"in d&&n(3,a=d.label),"show_label"in d&&n(4,i=d.show_label),"source"in d&&n(5,f=d.source),"tool"in d&&n(1,u=d.tool),"shape"in d&&n(6,c=d.shape),"streaming"in d&&n(7,_=d.streaming),"pending"in d&&n(8,b=d.pending),"mirror_webcam"in d&&n(9,M=d.mirror_webcam),"brush_radius"in d&&n(2,z=d.brush_radius),"selectable"in d&&n(10,ce=d.selectable),"$$scope"in d&&n(69,o=d.$$scope)},t.$$.update=()=>{t.$$.dirty[0]&1&&oe("change",s),t.$$.dirty[0]&4096&&oe("drag",K),t.$$.dirty[0]&34&&(f==="canvas"&&(u==="sketch"||u==="compose")?n(14,F="bw-sketch"):u==="color-sketch"?n(14,F="color-sketch"):(f==="upload"||f==="webcam")&&(u==="sketch"||u==="compose")?n(14,F="mask"):n(14,F="editor")),t.$$.dirty[0]&16384&&n(23,l=F=="mask"?"#000000":"#000"),t.$$.dirty[0]&1&&(s===null||s.image===null&&s.mask===null)&&n(22,ie=void 0),t.$$.dirty[0]&2049&&g&&(s?(n(11,g.image=s,g),g.create()):g.destroy()),t.$$.dirty[0]&57378&&(console.log("image.svelte source:",f),console.log("image.svelte tool:",u),console.log("image.svelte mode:",F),console.log("image.svelte container_height:",O),console.log("image.svelte max_height:",ne)),t.$$.dirty[0]&40960&&(console.log("container_height:",O),console.log("max_height:",ne))},[s,u,z,a,i,f,c,_,b,M,ce,g,K,O,F,ne,U,S,he,H,Z,ae,ie,l,A,w,L,ee,x,me,te,ye,r,Ae,De,Se,qe,Ue,Be,k,Ye,Le,Fe,We,de,Ge,Qe,Ve,Me,Ee,Ze,He,nt,Pe,Ke,xe,$e,et,m,j,q,W,G,se,Ne,ke,tt,Oe,lt,o]}let en=class extends ze{constructor(e){super(),je(this,e,il,ll,Ce,{value:0,label:3,show_label:4,source:5,tool:1,shape:6,streaming:7,pending:8,mirror_webcam:9,brush_radius:2,selectable:10},null,[-1,-1,-1])}};function sl(t){let e,n,l;function r(s){t[31](s)}let o={brush_radius:t[15],shape:t[14],source:t[5],tool:t[6],selectable:t[16],label:t[7],show_label:t[8],pending:t[10],streaming:t[9],mirror_webcam:t[13],$$slots:{default:[ol]},$$scope:{ctx:t}};return t[0]!==void 0&&(o.value=t[0]),e=new en({props:o}),N.push(()=>fe(e,"value",r)),e.$on("edit",t[32]),e.$on("clear",t[33]),e.$on("change",t[34]),e.$on("stream",t[35]),e.$on("drag",t[36]),e.$on("upload",t[37]),e.$on("select",t[38]),e.$on("error",t[39]),{c(){X(e.$$.fragment)},m(s,a){Y(e,s,a),l=!0},p(s,a){const i={};a[0]&32768&&(i.brush_radius=s[15]),a[0]&16384&&(i.shape=s[14]),a[0]&32&&(i.source=s[5]),a[0]&64&&(i.tool=s[6]),a[0]&65536&&(i.selectable=s[16]),a[0]&128&&(i.label=s[7]),a[0]&256&&(i.show_label=s[8]),a[0]&1024&&(i.pending=s[10]),a[0]&512&&(i.streaming=s[9]),a[0]&8192&&(i.mirror_webcam=s[13]),a[1]&1024&&(i.$$scope={dirty:a,ctx:s}),!n&&a[0]&1&&(n=!0,i.value=s[0],_e(()=>n=!1)),e.$set(i)},i(s){l||(v(e.$$.fragment,s),l=!0)},o(s){T(e.$$.fragment,s),l=!1},d(s){P(e,s)}}}function rl(t){let e,n,l;function r(s){t[22](s)}let o={brush_radius:t[15],shape:t[14],source:t[5],tool:t[6],selectable:t[16],label:t[7],show_label:t[8],pending:t[10],streaming:t[9],mirror_webcam:t[13],$$slots:{default:[al]},$$scope:{ctx:t}};return t[0]!==void 0&&(o.value=t[0]),e=new en({props:o}),N.push(()=>fe(e,"value",r)),e.$on("edit",t[23]),e.$on("clear",t[24]),e.$on("change",t[25]),e.$on("stream",t[26]),e.$on("drag",t[27]),e.$on("upload",t[28]),e.$on("select",t[29]),e.$on("error",t[30]),{c(){X(e.$$.fragment)},m(s,a){Y(e,s,a),l=!0},p(s,a){const i={};a[0]&32768&&(i.brush_radius=s[15]),a[0]&16384&&(i.shape=s[14]),a[0]&32&&(i.source=s[5]),a[0]&64&&(i.tool=s[6]),a[0]&65536&&(i.selectable=s[16]),a[0]&128&&(i.label=s[7]),a[0]&256&&(i.show_label=s[8]),a[0]&1024&&(i.pending=s[10]),a[0]&512&&(i.streaming=s[9]),a[0]&8192&&(i.mirror_webcam=s[13]),a[1]&1024&&(i.$$scope={dirty:a,ctx:s}),!n&&a[0]&1&&(n=!0,i.value=s[0],_e(()=>n=!1)),e.$set(i)},i(s){l||(v(e.$$.fragment,s),l=!0)},o(s){T(e.$$.fragment,s),l=!1},d(s){P(e,s)}}}function ol(t){let e,n;return e=new Zt({props:{type:"image"}}),{c(){X(e.$$.fragment)},m(l,r){Y(e,l,r),n=!0},p:le,i(l){n||(v(e.$$.fragment,l),n=!0)},o(l){T(e.$$.fragment,l),n=!1},d(l){P(e,l)}}}function al(t){let e,n;return e=new Zt({props:{type:"image"}}),{c(){X(e.$$.fragment)},m(l,r){Y(e,l,r),n=!0},p:le,i(l){n||(v(e.$$.fragment,l),n=!0)},o(l){T(e.$$.fragment,l),n=!1},d(l){P(e,l)}}}function ul(t){let e,n,l,r,o,s;const a=[t[1]];let i={};for(let _=0;_<a.length;_+=1)i=_n(i,a[_]);e=new hn({props:i});const f=[rl,sl],u=[];function c(_,b){return _[20]==="static"?0:1}return l=c(t),r=u[l]=f[l](t),{c(){X(e.$$.fragment),n=$(),r.c(),o=Xe()},m(_,b){Y(e,_,b),D(_,n,b),u[l].m(_,b),D(_,o,b),s=!0},p(_,b){const M=b[0]&2?cn(a,[mn(_[1])]):{};e.$set(M);let z=l;l=c(_),l===z?u[l].p(_,b):(pe(),T(u[z],1,1,()=>{u[z]=null}),we(),r=u[l],r?r.p(_,b):(r=u[l]=f[l](_),r.c()),v(r,1),r.m(o.parentNode,o))},i(_){s||(v(e.$$.fragment,_),v(r),s=!0)},o(_){T(e.$$.fragment,_),T(r),s=!1},d(_){P(e,_),_&&B(n),u[l].d(_),_&&B(o)}}}function fl(t){let e,n;return e=new gn({props:{visible:t[4],variant:t[20]==="dynamic"&&t[0]===null&&t[5]==="upload"?"dashed":"solid",border_mode:t[21]?"focus":"base",padding:!1,elem_id:t[2],elem_classes:t[3],height:t[11]||(t[5]==="webcam"||t[20]==="static"?void 0:Pt),width:t[12],allow_overflow:!1,container:t[17],scale:t[18],min_width:t[19],$$slots:{default:[ul]},$$scope:{ctx:t}}}),{c(){X(e.$$.fragment)},m(l,r){Y(e,l,r),n=!0},p(l,r){const o={};r[0]&16&&(o.visible=l[4]),r[0]&1048609&&(o.variant=l[20]==="dynamic"&&l[0]===null&&l[5]==="upload"?"dashed":"solid"),r[0]&2097152&&(o.border_mode=l[21]?"focus":"base"),r[0]&4&&(o.elem_id=l[2]),r[0]&8&&(o.elem_classes=l[3]),r[0]&1050656&&(o.height=l[11]||(l[5]==="webcam"||l[20]==="static"?void 0:Pt)),r[0]&4096&&(o.width=l[12]),r[0]&131072&&(o.container=l[17]),r[0]&262144&&(o.scale=l[18]),r[0]&524288&&(o.min_width=l[19]),r[0]&3270627|r[1]&1024&&(o.$$scope={dirty:r,ctx:l}),e.$set(o)},i(l){n||(v(e.$$.fragment,l),n=!0)},o(l){T(e.$$.fragment,l),n=!1},d(l){P(e,l)}}}const Pt=240;function _l(t,e,n){let{elem_id:l=""}=e,{elem_classes:r=[]}=e,{visible:o=!0}=e,{value:s=null}=e,{source:a="upload"}=e,{tool:i="editor"}=e,{label:f}=e,{show_label:u}=e,{streaming:c}=e,{pending:_}=e,{height:b}=e,{width:M}=e,{mirror_webcam:z}=e,{shape:ce}=e,{brush_radius:U}=e,{selectable:S=!1}=e,{container:g=!1}=e,{scale:A=1}=e,{min_width:w=void 0}=e,{loading_status:L}=e,{mode:ee}=e;const oe=Je();let K;function x(k){s=k,n(0,s)}function me(k){be.call(this,t,k)}function te(k){be.call(this,t,k)}function he(k){be.call(this,t,k)}function H(k){be.call(this,t,k)}const O=({detail:k})=>n(21,K=k);function F(k){be.call(this,t,k)}function Z(k){be.call(this,t,k)}const ne=({detail:k})=>{n(1,L=L||{}),n(1,L.status="error",L),n(1,L.message=k,L)};function ae(k){s=k,n(0,s)}function ie(k){be.call(this,t,k)}function ye(k){be.call(this,t,k)}function Ae(k){be.call(this,t,k)}function De(k){be.call(this,t,k)}const Se=({detail:k})=>n(21,K=k);function qe(k){be.call(this,t,k)}function Ue(k){be.call(this,t,k)}const Be=({detail:k})=>{n(1,L=L||{}),n(1,L.status="error",L),n(1,L.message=k,L)};return t.$$set=k=>{"elem_id"in k&&n(2,l=k.elem_id),"elem_classes"in k&&n(3,r=k.elem_classes),"visible"in k&&n(4,o=k.visible),"value"in k&&n(0,s=k.value),"source"in k&&n(5,a=k.source),"tool"in k&&n(6,i=k.tool),"label"in k&&n(7,f=k.label),"show_label"in k&&n(8,u=k.show_label),"streaming"in k&&n(9,c=k.streaming),"pending"in k&&n(10,_=k.pending),"height"in k&&n(11,b=k.height),"width"in k&&n(12,M=k.width),"mirror_webcam"in k&&n(13,z=k.mirror_webcam),"shape"in k&&n(14,ce=k.shape),"brush_radius"in k&&n(15,U=k.brush_radius),"selectable"in k&&n(16,S=k.selectable),"container"in k&&n(17,g=k.container),"scale"in k&&n(18,A=k.scale),"min_width"in k&&n(19,w=k.min_width),"loading_status"in k&&n(1,L=k.loading_status),"mode"in k&&n(20,ee=k.mode)},t.$$.update=()=>{t.$$.dirty[0]&1&&n(0,s=s||null),t.$$.dirty[0]&1&&oe("change")},[s,L,l,r,o,a,i,f,u,c,_,b,M,z,ce,U,S,g,A,w,ee,K,x,me,te,he,H,O,F,Z,ne,ae,ie,ye,Ae,De,Se,qe,Ue,Be]}class hl extends ze{constructor(e){super(),je(this,e,_l,fl,Ce,{elem_id:2,elem_classes:3,visible:4,value:0,source:5,tool:6,label:7,show_label:8,streaming:9,pending:10,height:11,width:12,mirror_webcam:13,shape:14,brush_radius:15,selectable:16,container:17,scale:18,min_width:19,loading_status:1,mode:20},null,[-1,-1])}}const Rl=hl,Tl=["static","dynamic"],zl=t=>({type:{payload:"string"},description:{payload:"image data as base64 string"},example_data:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAACklEQVR4nGMAAQAABQABDQottAAAAABJRU5ErkJggg=="});export{Rl as Component,Bl as ExampleComponent,zl as document,Tl as modes};
//# sourceMappingURL=index-57824d23.js.map
